package com.coretek.testcase.testcaseview.actions;

import org.eclipse.core.resources.IFile;
import org.eclipse.core.resources.IFolder;
import org.eclipse.jface.dialogs.MessageDialog;
import org.eclipse.jface.util.OpenStrategy;
import org.eclipse.jface.viewers.StructuredSelection;
import org.eclipse.ui.PartInitException;
import org.eclipse.ui.ide.IDE;

import com.coretek.common.i18n.messages.Messages;
import com.coretek.common.utils.EclipseUtils;
import com.coretek.common.utils.StringUtils;
import com.coretek.spte.core.util.Utils;
import com.coretek.testcase.testcaseview.TestCase;
import com.coretek.testcase.testcaseview.TestCaseViewPart;

/**
 * 打开测试用例
 * 
 * @author 孙大巍
 * @date 2010-12-3
 * 
 */
public class OpenTestCaseAction extends AbstractAction
{

	public OpenTestCaseAction(TestCaseViewPart viewPart)
	{
		super(viewPart);
		this.setText(Messages.getString("I18N_OPEN_TESTCASE"));
	}

	@Override
	public void run()
	{
		TestCase test = (TestCase) ((StructuredSelection) this.viewPart.getTableViewer().getSelection()).getFirstElement();
		boolean activate = OpenStrategy.activateOnOpen();
		try
		{
			IFolder folder = (IFolder) Utils.getCaseByName(test.getProjectName(), test.getSuitePath(), test.getCaseName()).getParent();
			IFile file = folder.getFile(test.getCaseName());
			if (file == null || !file.exists())
			{
				MessageDialog.openError(Utils.getShell(), "错误", StringUtils.concat("找不到", test, "文件"));
				return;
			}
			IDE.openEditor(EclipseUtils.getActivePage(), file, activate);
		} catch (PartInitException e)
		{
			e.printStackTrace();
		}
	}

}
