package com.coretek.testcase.testResult.actions;

import org.eclipse.core.resources.IFile;
import org.eclipse.jface.dialogs.MessageDialog;
import org.eclipse.jface.util.OpenStrategy;
import org.eclipse.jface.viewers.StructuredSelection;
import org.eclipse.ui.PartInitException;
import org.eclipse.ui.ide.IDE;

import com.coretek.common.i18n.messages.Messages;
import com.coretek.common.utils.EclipseUtils;
import com.coretek.spte.core.util.Utils;
import com.coretek.spte.dataCompare.CompareResult;
import com.coretek.testcase.testResult.TestResultViewPart;

/**
 * 打开测试用例
 * 
 * @author 孙大巍
 * @date 2010-12-4
 * 
 */
public class OpenTestCaseAction extends AbstractAction
{

	public OpenTestCaseAction(TestResultViewPart viewPart)
	{
		super(viewPart);
		this.setText(Messages.getString("I18N_OPEN_TESTCASE"));
	}

	@Override
	public void run()
	{
		Object object = ((StructuredSelection) this.viewPart.getTableViewer().getSelection()).getFirstElement();

		if (object instanceof CompareResult)
		{
			CompareResult compareResult = (CompareResult) object;

			boolean activate = OpenStrategy.activateOnOpen();
			try
			{
				IFile iFile = compareResult.getTestCaseFile();
				if (iFile == null || !iFile.exists())
				{
					MessageDialog.openError(Utils.getShell(), "错误", "找不到测试用例文件！测试用例文件已经被删除");
					return;
				}
				IDE.openEditor(EclipseUtils.getActivePage(), iFile, activate);

			} catch (PartInitException e)
			{
				e.printStackTrace();
			}
		}

	}

}
